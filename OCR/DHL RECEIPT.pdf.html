<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>OCR Results Viewer</title>
            <style>
                
                :root {
                    --bg-primary: #0f172a;
                    --bg-secondary: #1e293b;
                    --bg-tertiary: #334155;
                    --text-primary: #f1f5f9;
                    --text-secondary: #cbd5e1;
                    --accent: #3b82f6;
                    --accent-hover: #2563eb;
                    --success: #10b981;
                    --warning: #f59e0b;
                    --danger: #ef4444;
                    --border: #334155;
                }
                
                [data-theme="light"] {
                    --bg-primary: #f8fafc;
                    --bg-secondary: #ffffff;
                    --bg-tertiary: #f1f5f9;
                    --text-primary: #1e293b;
                    --text-secondary: #64748b;
                    --border: #e2e8f0;
                }
            

                * {
                    box-sizing: border-box;
                }
                
                body {
                    margin: 0;
                    background: var(--bg-primary);
                    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    color: var(--text-primary);
                    line-height: 1.6;
                    transition: background 0.3s, color 0.3s;
                    overflow-x: hidden;
                }
                
                .main-container {
                    display: flex;
                    height: 100vh;
                }
                
                .thumbnail-sidebar {
                    width: 160px;
                    background: var(--bg-secondary);
                    overflow-y: auto;
                    border-right: 1px solid var(--border);
                    padding: 10px;
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                }
                
                .thumbnail {
                    cursor: pointer;
                    border: 2px solid transparent;
                    border-radius: 6px;
                    overflow: hidden;
                    transition: all 0.2s;
                    background: var(--bg-tertiary);
                }
                
                .thumbnail:hover {
                    border-color: var(--accent);
                    transform: translateY(-2px);
                }
                
                .thumbnail.active {
                    border-color: var(--accent);
                    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
                }
                
                .thumbnail img {
                    width: 100%;
                    height: auto;
                    display: block;
                }
                
                .thumbnail-label {
                    padding: 6px;
                    text-align: center;
                    font-size: 12px;
                    font-weight: 500;
                    color: var(--text-secondary);
                }
                
                .content-container {
                    flex: 1;
                    display: flex;
                    flex-direction: column;
                    overflow: hidden;
                }
            

                .progress-container {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    height: 4px;
                    background: var(--bg-primary);
                    z-index: 3000;
                    display: none;
                }
                
                .progress-bar {
                    height: 100%;
                    background: var(--accent);
                    width: 0%;
                    transition: width 0.3s;
                }
                
                .progress-text {
                    position: absolute;
                    top: 5px;
                    right: 10px;
                    font-size: 12px;
                    color: var(--text-primary);
                    background: var(--bg-secondary);
                    padding: 2px 8px;
                    border-radius: 10px;
                }
            

                .toolbar {
                    background: var(--bg-secondary);
                    border-bottom: 1px solid var(--border);
                    position: sticky;
                    top: 0;
                    z-index: 1000;
                    transition: background 0.3s, border-color 0.3s;
                }
                
                .toolbar-row {
                    padding: 12px 20px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                }
                
                .toolbar-row:first-child {
                    border-bottom: 1px solid var(--border);
                }
                
                .toolbar-left, .toolbar-right {
                    display: flex;
                    align-items: center;
                    gap: 12px 24px;
                }
                
                .toolbar-group {
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    padding: 8px 12px;
                    background: var(--bg-tertiary);
                    border-radius: 8px;
                    border: 1px solid transparent;
                    transition: all 0.2s;
                }
                
                .toolbar-group:hover {
                    border-color: var(--accent);
                }
            

                .toolbar label {
                    font-weight: 500;
                    color: var(--text-secondary);
                    font-size: 13px;
                    white-space: nowrap;
                }
                
                .toolbar input[type="range"] {
                    width: 120px;
                    height: 5px;
                    background: var(--bg-primary);
                    border-radius: 3px;
                    outline: none;
                    -webkit-appearance: none;
                }
                
                .toolbar input[type="range"]::-webkit-slider-thumb {
                    -webkit-appearance: none;
                    width: 16px;
                    height: 16px;
                    background: var(--accent);
                    border-radius: 50%;
                    cursor: pointer;
                    transition: all 0.2s;
                }
                
                .toolbar input[type="range"]::-webkit-slider-thumb:hover {
                    background: var(--accent-hover);
                    transform: scale(1.1);
                }
                
                .toolbar input[type="text"] {
                    padding: 8px 12px;
                    background: var(--bg-primary);
                    border: 1px solid var(--border);
                    border-radius: 6px;
                    color: var(--text-primary);
                    font-size: 13px;
                    width: 180px;
                    transition: all 0.2s;
                }
                
                .toolbar input[type="text"]:focus {
                    outline: none;
                    border-color: var(--accent);
                }
                
                .toolbar button {
                    padding: 8px 14px;
                    background: var(--accent);
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-weight: 500;
                    font-size: 13px;
                    cursor: pointer;
                    transition: all 0.2s;
                    display: flex;
                    align-items: center;
                    gap: 6px;
                }
                
                .toolbar button:hover {
                    background: var(--accent-hover);
                }
                
                .toolbar button:disabled {
                    opacity: 0.5;
                    cursor: not-allowed;
                }
            

                .pages-wrapper {
                    padding: 40px 20px;
                    display: flex;
                    flex-direction: column;
                    gap: 40px;
                    overflow-x: hidden;
                    overflow-y: auto;
                    align-items: center;
                    min-height: calc(100vh - 140px);
                    flex: 1;
                }
                
                .pages-wrapper::-webkit-scrollbar {
                    width: 12px;
                }
                
                .pages-wrapper::-webkit-scrollbar-track {
                    background: var(--bg-tertiary);
                    border-radius: 6px;
                }
                
                .pages-wrapper::-webkit-scrollbar-thumb {
                    background: var(--accent);
                    border-radius: 6px;
                }
                
                .pages-wrapper::-webkit-scrollbar-thumb:hover {
                    background: var(--accent-hover);
                }
                
                .page-container {
                    position: relative;
                    background: white;
                    border-radius: 8px;
                    overflow: hidden;
                    transition: transform 0.2s;
                    flex-shrink: 0;
                    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                    max-width: 100%;
                    width: fit-content;
                    min-height: 200px;
                }
                
                .lazy-page {
                    min-height: 300px;
                }
                
                .page-placeholder {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    height: 300px;
                    background: var(--bg-tertiary);
                    color: var(--text-secondary);
                    font-weight: 500;
                }
                
                .ocr-image {
                    display: block;
                    width: auto;
                    max-width: none;
                    height: auto;
                }
            

                .ocr-line {
                    position: absolute;
                    pointer-events: auto;
                    cursor: pointer;
                    transition: all 0.2s;
                }
                
                .ocr-line:hover {
                    z-index: 10;
                }
                
                .ocr-line.selected {
                    outline: 2px solid var(--accent);
                    outline-offset: 2px;
                }
                
                .underline {
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    width: 100%;
                    height: 3px;
                    opacity: 0.9;
                    transition: all 0.2s;
                }
                
                .ocr-line[data-edited="true"] .underline {
                    background-color: var(--warning) !important;
                    height: 4px;
                }
                
                .ocr-tooltip {
                    visibility: hidden;
                    position: absolute;
                    bottom: 100%;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(30, 41, 59, 0.95);
                    color: var(--text-primary);
                    padding: 8px 12px;
                    border-radius: 6px;
                    font-size: 13px;
                    white-space: nowrap;
                    opacity: 0;
                    transition: opacity 0.2s, transform 0.2s;
                    backdrop-filter: blur(10px);
                    border: 1px solid var(--border);
                    margin-bottom: 8px;
                }
                
                .ocr-tooltip::after {
                    content: '';
                    position: absolute;
                    top: 100%;
                    left: 50%;
                    transform: translateX(-50%);
                    border-width: 6px;
                    border-style: solid;
                    border-color: rgba(30, 41, 59, 0.95) transparent transparent transparent;
                }
                
                .ocr-line:hover .ocr-tooltip {
                    visibility: visible;
                    opacity: 1;
                    transform: translateX(-50%) translateY(-4px);
                }
            

                .modal {
                    display: none;
                    position: fixed;
                    z-index: 2000;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(15, 23, 42, 0.8);
                    backdrop-filter: blur(4px);
                    animation: fadeIn 0.2s;
                }
                
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                
                .modal-content {
                    background-color: var(--bg-secondary);
                    margin: 10% auto;
                    padding: 24px;
                    border: 1px solid var(--border);
                    width: 50%;
                    max-width: 600px;
                    border-radius: 12px;
                    animation: slideIn 0.3s;
                    transition: background 0.3s, border-color 0.3s;
                }
                
                @keyframes slideIn {
                    from { transform: translateY(-20px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                
                .modal h3 {
                    margin-top: 0;
                    font-size: 18px;
                    font-weight: 600;
                    color: var(--text-primary);
                }
                
                .modal-buttons {
                    display: flex;
                    justify-content: flex-end;
                    gap: 12px;
                    margin-top: 20px;
                }
                
                .modal textarea {
                    width: 100%;
                    min-height: 120px;
                    background: var(--bg-tertiary);
                    color: var(--text-primary);
                    border: 1px solid var(--border);
                    padding: 12px;
                    border-radius: 6px;
                    font-family: inherit;
                    font-size: 14px;
                    resize: vertical;
                    transition: all 0.2s;
                }
                
                .modal textarea:focus {
                    outline: none;
                    border-color: var(--accent);
                }
                
                .modal button {
                    padding: 8px 16px;
                    border-radius: 6px;
                    font-weight: 500;
                    font-size: 14px;
                    cursor: pointer;
                    transition: all 0.2s;
                }
                
                .modal button:first-of-type {
                    background: var(--bg-tertiary);
                    color: var(--text-primary);
                    border: 1px solid var(--border);
                }
                
                .modal button:first-of-type:hover {
                    background: var(--border);
                }
                
                .modal button:last-of-type {
                    background: var(--accent);
                    color: white;
                    border: none;
                }
                
                .modal button:last-of-type:hover {
                    background: var(--accent-hover);
                }
            

                .drawing-box {
                    position: absolute;
                    border: 2px dashed var(--accent);
                    background: rgba(59, 130, 246, 0.1);
                    pointer-events: none;
                    display: none;
                    border-radius: 4px;
                }
                
                .edited-badge {
                    position: absolute;
                    top: -10px;
                    right: -10px;
                    background: var(--warning);
                    color: var(--bg-primary);
                    font-size: 10px;
                    font-weight: 700;
                    padding: 3px 6px;
                    border-radius: 4px;
                    display: none;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                .ocr-line[data-edited="true"] .edited-badge {
                    display: block;
                }
                
                .stats-grid {
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 16px;
                    margin-top: 16px;
                }
                
                .stat-card {
                    background: var(--bg-tertiary);
                    padding: 16px;
                    border-radius: 8px;
                    border: 1px solid var(--border);
                }
                
                .stat-label {
                    font-size: 14px;
                    color: var(--text-secondary);
                    margin-bottom: 4px;
                }
                
                .stat-value {
                    font-size: 24px;
                    font-weight: 600;
                    color: var(--text-primary);
                }
                
                .export-options {
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                    margin-top: 16px;
                }
                
                .export-option {
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    padding: 12px;
                    background: var(--bg-tertiary);
                    border-radius: 8px;
                    border: 1px solid var(--border);
                    cursor: pointer;
                    transition: all 0.2s;
                }
                
                .export-option:hover {
                    border-color: var(--accent);
                }
                
                .export-option input[type="radio"] {
                    margin: 0;
                }
                
                .export-option label {
                    flex: 1;
                    cursor: pointer;
                    margin: 0;
                    font-weight: 500;
                }
                
                /* Collapsible toolbar styles */
                #toolbarSecondRow {
                    transition: all 0.3s ease;
                    overflow: hidden;
                }
                
                #toolbarSecondRow.collapsed {
                    max-height: 0;
                    padding: 0;
                    border: none;
                }
                
                .collapse-btn {
                    background: transparent !important;
                    padding: 6px !important;
                    border: 1px solid var(--border) !important;
                    border-radius: 4px !important;
                }
                
                .collapse-btn:hover {
                    background: var(--bg-tertiary) !important;
                }
                
                .toolbar-icon {
                    width: 16px;
                    height: 16px;
                }
                
                .threshold-value {
                    background: var(--bg-primary);
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-weight: 600;
                    color: var(--accent);
                    min-width: 40px;
                    text-align: center;
                    font-size: 13px;
                }
            
            </style>
        </head>
        <body>
            <div id="progressBar" class="progress-container">
                <div id="progressFill" class="progress-bar"></div>
                <div id="progressText" class="progress-text">0%</div>
            </div>
            
            <div class="main-container">
                <div class="content-container">
                    <div class="toolbar">
                        <!-- First Row: Main Controls -->
                        <div class="toolbar-row">
                            <div class="toolbar-left">
                                <div class="toolbar-group">
                                    <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                    <label>OCR Viewer</label>
                                </div>
                                
                                <div class="toolbar-group">
                                    <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="20" x2="18" y2="10"></line>
                                        <line x1="12" y1="20" x2="12" y2="4"></line>
                                        <line x1="6" y1="20" x2="6" y2="14"></line>
                                    </svg>
                                    <label>Confidence:</label>
                                    <input type="range" min="0" max="1" step="0.01" value="0.9" id="thresholdSlider">
                                    <span class="threshold-value" id="thresholdVal">0.9</span>
                                </div>
                                
                                <div class="toolbar-group">
                                    <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                    </svg>
                                    <input type="text" id="textFilter" placeholder="Search text...">
                                </div>
                            </div>
                            
                            <div class="toolbar-right">
                                <div class="toolbar-group">
                                    <button id="addTextBtn">
                                        <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="12" y1="5" x2="12" y2="19"></line>
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                        </svg>
                                        Add Text
                                    </button>
                                    <button id="saveBtn">
                                        <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path>
                                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                            <polyline points="7 3 7 8 15 8"></polyline>
                                        </svg>
                                        Save
                                    </button>
                                    <button id="collapseBtn" class="collapse-btn" title="Toggle Toolbar">
                                        <svg class="toolbar-icon" id="collapseIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="18 15 12 9 6 15"></polyline>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Second Row: Additional Controls -->
                        <div class="toolbar-row" id="toolbarSecondRow">
                            <div class="toolbar-left">
                                <div class="toolbar-group">
                                    <button id="undoBtn" disabled>
                                        <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M3 7v6h6"></path>
                                            <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"></path>
                                        </svg>
                                    </button>
                                    <button id="redoBtn" disabled>
                                        <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 7v6h-6"></path>
                                            <path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"></path>
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="toolbar-group">
                                    <button id="zoomOutBtn">
                                        <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="11" cy="11" r="8"></circle>
                                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                            <line x1="8" y1="11" x2="14" y2="11"></line>
                                        </svg>
                                    </button>
                                    <span id="zoomLevel">100%</span>
                                    <button id="zoomInBtn">
                                        <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="11" cy="11" r="8"></circle>
                                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                            <line x1="11" y1="8" x2="11" y2="14"></line>
                                            <line x1="8" y1="11" x2="14" y2="11"></line>
                                        </svg>
                                    </button>
                                    <button id="zoomResetBtn">
                                        <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="1 4 1 10 7 10"></polyline>
                                            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="toolbar-right">
                                <div class="toolbar-group">
                                    <button id="themeToggle">
                                        <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="5"></circle>
                                            <line x1="12" y1="1" x2="12" y2="3"></line>
                                            <line x1="12" y1="21" x2="12" y2="23"></line>
                                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                            <line x1="1" y1="12" x2="3" y2="12"></line>
                                            <line x1="21" y1="12" x2="23" y2="12"></line>
                                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                                        </svg>
                                    </button>
                                </div>
                                
                                <div class="toolbar-group">
                                    <button id="statsBtn">
                                        <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="18" y1="20" x2="18" y2="10"></line>
                                            <line x1="12" y1="20" x2="12" y2="4"></line>
                                            <line x1="6" y1="20" x2="6" y2="14"></line>
                                        </svg>
                                        Stats
                                    </button>
                                </div>
                                
                                <div class="toolbar-group">
                                    <button id="exportBtn">
                                        <svg class="toolbar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
                                            <polyline points="7 10 12 15 17 10"></polyline>
                                            <line x1="12" y1="15" x2="12" y2="3"></line>
                                        </svg>
                                        Export
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pages-wrapper" id="pagesWrapper">
                        
            <div class="page-container" id="page-0">
                <img class="ocr-image" src="res\3\0.png" alt="Page 0" />
                
        <div class="ocr-line" data-score="0.526731550693512" data-text="1 9000000000000000()"
             data-original-text="1 9000000000000000()" data-index="0" data-page="0"
             data-edited="false" style="left:1187px;top:94px;width:197px;height:21px;">
            <div class="underline" style="background-color:rgb(120,134,100);"></div>
            <div class="ocr-tooltip">1 9000000000000000() (Confidence: 52.67%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.35640445351600647" data-text="20000000221"
             data-original-text="20000000221" data-index="1" data-page="0"
             data-edited="false" style="left:1187px;top:225px;width:145px;height:21px;">
            <div class="underline" style="background-color:rgb(164,90,100);"></div>
            <div class="ocr-tooltip">20000000221 (Confidence: 35.64%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.2870069742202759" data-text="52 420 10 200"
             data-original-text="52 420 10 200" data-index="2" data-page="0"
             data-edited="false" style="left:1182px;top:371px;width:264px;height:42px;">
            <div class="underline" style="background-color:rgb(181,73,100);"></div>
            <div class="ocr-tooltip">52 420 10 200 (Confidence: 28.70%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.9176055788993835" data-text="￥"
             data-original-text="￥" data-index="3" data-page="0"
             data-edited="false" style="left:1100px;top:440px;width:15px;height:15px;">
            <div class="underline" style="background-color:rgb(21,233,100);"></div>
            <div class="ocr-tooltip">￥ (Confidence: 91.76%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.7061429023742676" data-text="7"
             data-original-text="7" data-index="4" data-page="0"
             data-edited="false" style="left:1128px;top:438px;width:17px;height:18px;">
            <div class="underline" style="background-color:rgb(74,180,100);"></div>
            <div class="ocr-tooltip">7 (Confidence: 70.61%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.9542743563652039" data-text="0"
             data-original-text="0" data-index="5" data-page="0"
             data-edited="false" style="left:1158px;top:439px;width:18px;height:17px;">
            <div class="underline" style="background-color:rgb(11,243,100);"></div>
            <div class="ocr-tooltip">0 (Confidence: 95.43%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.6950271129608154" data-text="m"
             data-original-text="m" data-index="6" data-page="0"
             data-edited="false" style="left:1184px;top:438px;width:29px;height:19px;">
            <div class="underline" style="background-color:rgb(77,177,100);"></div>
            <div class="ocr-tooltip">m (Confidence: 69.50%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.9950974583625793" data-text="9"
             data-original-text="9" data-index="7" data-page="0"
             data-edited="false" style="left:1213px;top:439px;width:25px;height:17px;">
            <div class="underline" style="background-color:rgb(1,253,100);"></div>
            <div class="ocr-tooltip">9 (Confidence: 99.51%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.3290979862213135" data-text="レ"
             data-original-text="レ" data-index="8" data-page="0"
             data-edited="false" style="left:1247px;top:440px;width:28px;height:16px;">
            <div class="underline" style="background-color:rgb(171,83,100);"></div>
            <div class="ocr-tooltip">レ (Confidence: 32.91%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.6260130405426025" data-text="0ε222"
             data-original-text="0ε222" data-index="9" data-page="0"
             data-edited="false" style="left:1268px;top:437px;width:177px;height:21px;">
            <div class="underline" style="background-color:rgb(95,159,100);"></div>
            <div class="ocr-tooltip">0ε222 (Confidence: 62.60%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.0" data-text=""
             data-original-text="" data-index="10" data-page="0"
             data-edited="false" style="left:999px;top:541px;width:38px;height:19px;">
            <div class="underline" style="background-color:rgb(255,0,100);"></div>
            <div class="ocr-tooltip"> (Confidence: 0.00%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.9661644697189331" data-text="00&apos;0"
             data-original-text="00&apos;0" data-index="11" data-page="0"
             data-edited="false" style="left:1090px;top:538px;width:38px;height:23px;">
            <div class="underline" style="background-color:rgb(8,246,100);"></div>
            <div class="ocr-tooltip">00&apos;0 (Confidence: 96.62%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.5566611886024475" data-text="ai"
             data-original-text="AI" data-index="12" data-page="0"
             data-edited="false" style="left:1222px;top:540px;width:23px;height:21px;">
            <div class="underline" style="background-color:rgb(113,141,100);"></div>
            <div class="ocr-tooltip">AI (Confidence: 55.67%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.2169278860092163" data-text="tee"
             data-original-text="TEE" data-index="13" data-page="0"
             data-edited="false" style="left:999px;top:567px;width:38px;height:19px;">
            <div class="underline" style="background-color:rgb(199,55,100);"></div>
            <div class="ocr-tooltip">TEE (Confidence: 21.69%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.9426555633544922" data-text="00&apos;0"
             data-original-text="00&apos;0" data-index="14" data-page="0"
             data-edited="false" style="left:1092px;top:566px;width:38px;height:19px;">
            <div class="underline" style="background-color:rgb(14,240,100);"></div>
            <div class="ocr-tooltip">00&apos;0 (Confidence: 94.27%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.38134631514549255" data-text="nae n"
             data-original-text="nae n" data-index="15" data-page="0"
             data-edited="false" style="left:1134px;top:564px;width:111px;height:20px;">
            <div class="underline" style="background-color:rgb(157,97,100);"></div>
            <div class="ocr-tooltip">nae n (Confidence: 38.13%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.2524975836277008" data-text="eer eee eree"
             data-original-text="eer eee eree" data-index="16" data-page="0"
             data-edited="false" style="left:1323px;top:564px;width:190px;height:20px;">
            <div class="underline" style="background-color:rgb(190,64,100);"></div>
            <div class="ocr-tooltip">eer eee eree (Confidence: 25.25%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.22365088760852814" data-text="sii"
             data-original-text="sii" data-index="17" data-page="0"
             data-edited="false" style="left:1441px;top:591px;width:73px;height:17px;">
            <div class="underline" style="background-color:rgb(197,57,100);"></div>
            <div class="ocr-tooltip">sii (Confidence: 22.37%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.19221428036689758" data-text="e"
             data-original-text="e" data-index="18" data-page="0"
             data-edited="false" style="left:1454px;top:614px;width:60px;height:17px;">
            <div class="underline" style="background-color:rgb(205,49,100);"></div>
            <div class="ocr-tooltip">e (Confidence: 19.22%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.28400906920433044" data-text="1/"
             data-original-text="1/" data-index="19" data-page="0"
             data-edited="false" style="left:977px;top:644px;width:36px;height:20px;">
            <div class="underline" style="background-color:rgb(182,72,100);"></div>
            <div class="ocr-tooltip">1/ (Confidence: 28.40%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.7350661754608154" data-text="b_$"
             data-original-text="b_$" data-index="20" data-page="0"
             data-edited="false" style="left:1067px;top:642px;width:25px;height:21px;">
            <div class="underline" style="background-color:rgb(67,187,100);"></div>
            <div class="ocr-tooltip">b_$ (Confidence: 73.51%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.35251277685165405" data-text="00.0"
             data-original-text="00.0" data-index="21" data-page="0"
             data-edited="false" style="left:1113px;top:643px;width:41px;height:22px;">
            <div class="underline" style="background-color:rgb(165,89,100);"></div>
            <div class="ocr-tooltip">00.0 (Confidence: 35.25%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.44456905126571655" data-text="1000"
             data-original-text="1000" data-index="22" data-page="0"
             data-edited="false" style="left:1154px;top:643px;width:54px;height:21px;">
            <div class="underline" style="background-color:rgb(141,113,100);"></div>
            <div class="ocr-tooltip">1000 (Confidence: 44.46%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.2745641767978668" data-text="12220222232000300222"
             data-original-text="12220222232000300222" data-index="23" data-page="0"
             data-edited="false" style="left:1237px;top:646px;width:275px;height:17px;">
            <div class="underline" style="background-color:rgb(184,70,100);"></div>
            <div class="ocr-tooltip">12220222232000300222 (Confidence: 27.46%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.1967449188232422" data-text="ee"
             data-original-text="ee" data-index="24" data-page="0"
             data-edited="false" style="left:994px;top:665px;width:40px;height:22px;">
            <div class="underline" style="background-color:rgb(204,50,100);"></div>
            <div class="ocr-tooltip">ee (Confidence: 19.67%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.26998716592788696" data-text="m ndsrbd ae dpd"
             data-original-text="m ndsrBd ae dpd" data-index="25" data-page="0"
             data-edited="false" style="left:1048px;top:667px;width:244px;height:17px;">
            <div class="underline" style="background-color:rgb(186,68,100);"></div>
            <div class="ocr-tooltip">m ndsrBd ae dpd (Confidence: 27.00%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.17226135730743408" data-text="150505300"
             data-original-text="150505300" data-index="26" data-page="0"
             data-edited="false" style="left:1336px;top:668px;width:80px;height:17px;">
            <div class="underline" style="background-color:rgb(211,43,100);"></div>
            <div class="ocr-tooltip">150505300 (Confidence: 17.23%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.28933966159820557" data-text="o r"
             data-original-text="O r" data-index="27" data-page="0"
             data-edited="false" style="left:1428px;top:667px;width:85px;height:17px;">
            <div class="underline" style="background-color:rgb(181,73,100);"></div>
            <div class="ocr-tooltip">O r (Confidence: 28.93%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.0" data-text=""
             data-original-text="" data-index="28" data-page="0"
             data-edited="false" style="left:1118px;top:693px;width:362px;height:38px;">
            <div class="underline" style="background-color:rgb(255,0,100);"></div>
            <div class="ocr-tooltip"> (Confidence: 0.00%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.0" data-text=""
             data-original-text="" data-index="29" data-page="0"
             data-edited="false" style="left:996px;top:714px;width:42px;height:15px;">
            <div class="underline" style="background-color:rgb(255,0,100);"></div>
            <div class="ocr-tooltip"> (Confidence: 0.00%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.5244758129119873" data-text="aeo"
             data-original-text="AEO" data-index="30" data-page="0"
             data-edited="false" style="left:1047px;top:714px;width:27px;height:15px;">
            <div class="underline" style="background-color:rgb(121,133,100);"></div>
            <div class="ocr-tooltip">AEO (Confidence: 52.45%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.5765188932418823" data-text=" - ih - yd"
             data-original-text=" - IH - Yd" data-index="31" data-page="0"
             data-edited="false" style="left:1146px;top:732px;width:230px;height:37px;">
            <div class="underline" style="background-color:rgb(107,147,100);"></div>
            <div class="ocr-tooltip"> - IH - Yd (Confidence: 57.65%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.19800615310668945" data-text="1005"
             data-original-text="1005" data-index="32" data-page="0"
             data-edited="false" style="left:989px;top:781px;width:42px;height:18px;">
            <div class="underline" style="background-color:rgb(204,50,100);"></div>
            <div class="ocr-tooltip">1005 (Confidence: 19.80%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.16725552082061768" data-text="nassoiie"
             data-original-text="NASSOIIE" data-index="33" data-page="0"
             data-edited="false" style="left:1391px;top:779px;width:79px;height:18px;">
            <div class="underline" style="background-color:rgb(212,42,100);"></div>
            <div class="ocr-tooltip">NASSOIIE (Confidence: 16.73%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.0" data-text=""
             data-original-text="" data-index="34" data-page="0"
             data-edited="false" style="left:1000px;top:802px;width:27px;height:20px;">
            <div class="underline" style="background-color:rgb(255,0,100);"></div>
            <div class="ocr-tooltip"> (Confidence: 0.00%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.16083510220050812" data-text="araarae"
             data-original-text="ARAARAE" data-index="35" data-page="0"
             data-edited="false" style="left:1302px;top:802px;width:72px;height:17px;">
            <div class="underline" style="background-color:rgb(213,41,100);"></div>
            <div class="ocr-tooltip">ARAARAE (Confidence: 16.08%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.2893519997596741" data-text="2002"
             data-original-text="2002" data-index="36" data-page="0"
             data-edited="false" style="left:1424px;top:801px;width:47px;height:18px;">
            <div class="underline" style="background-color:rgb(181,73,100);"></div>
            <div class="ocr-tooltip">2002 (Confidence: 28.94%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.5864158868789673" data-text="vn"
             data-original-text="VN" data-index="37" data-page="0"
             data-edited="false" style="left:1440px;top:827px;width:30px;height:17px;">
            <div class="underline" style="background-color:rgb(105,149,100);"></div>
            <div class="ocr-tooltip">VN (Confidence: 58.64%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.17736883461475372" data-text="rarrnctie"
             data-original-text="RARRNCTIE" data-index="38" data-page="0"
             data-edited="false" style="left:1321px;top:851px;width:148px;height:17px;">
            <div class="underline" style="background-color:rgb(209,45,100);"></div>
            <div class="ocr-tooltip">RARRNCTIE (Confidence: 17.74%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.1798427253961563" data-text="sonetsintsco en sntns"
             data-original-text="SONETSINTSCO EN SNTNS" data-index="39" data-page="0"
             data-edited="false" style="left:1212px;top:875px;width:257px;height:17px;">
            <div class="underline" style="background-color:rgb(209,45,100);"></div>
            <div class="ocr-tooltip">SONETSINTSCO EN SNTNS (Confidence: 17.98%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.35657650232315063" data-text="t n "
             data-original-text="T N " data-index="40" data-page="0"
             data-edited="false" style="left:1308px;top:896px;width:162px;height:20px;">
            <div class="underline" style="background-color:rgb(164,90,100);"></div>
            <div class="ocr-tooltip">T N  (Confidence: 35.66%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.22406281530857086" data-text="celna teie eesee"
             data-original-text="CELNA TEIE EESEE" data-index="41" data-page="0"
             data-edited="false" style="left:1301px;top:921px;width:169px;height:17px;">
            <div class="underline" style="background-color:rgb(197,57,100);"></div>
            <div class="ocr-tooltip">CELNA TEIE EESEE (Confidence: 22.41%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.8125355839729309" data-text=":01"
             data-original-text=":01" data-index="42" data-page="0"
             data-edited="false" style="left:1481px;top:917px;width:32px;height:20px;">
            <div class="underline" style="background-color:rgb(47,207,100);"></div>
            <div class="ocr-tooltip">:01 (Confidence: 81.25%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.7560369372367859" data-text="e/u"
             data-original-text="e/u" data-index="43" data-page="0"
             data-edited="false" style="left:1401px;top:948px;width:24px;height:16px;">
            <div class="underline" style="background-color:rgb(62,192,100);"></div>
            <div class="ocr-tooltip">e/u (Confidence: 75.60%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.9482285380363464" data-text="4d"
             data-original-text="4d" data-index="44" data-page="0"
             data-edited="false" style="left:1438px;top:949px;width:23px;height:17px;">
            <div class="underline" style="background-color:rgb(13,241,100);"></div>
            <div class="ocr-tooltip">4d (Confidence: 94.82%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.13972416520118713" data-text="ttrea"
             data-original-text="TTREA" data-index="45" data-page="0"
             data-edited="false" style="left:1399px;top:971px;width:61px;height:17px;">
            <div class="underline" style="background-color:rgb(219,35,100);"></div>
            <div class="ocr-tooltip">TTREA (Confidence: 13.97%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.7052821516990662" data-text="neim"
             data-original-text="NEIM" data-index="46" data-page="0"
             data-edited="false" style="left:1336px;top:993px;width:39px;height:16px;">
            <div class="underline" style="background-color:rgb(75,179,100);"></div>
            <div class="ocr-tooltip">NEIM (Confidence: 70.53%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.37637415528297424" data-text="200"
             data-original-text="200" data-index="47" data-page="0"
             data-edited="false" style="left:1426px;top:992px;width:34px;height:19px;">
            <div class="underline" style="background-color:rgb(159,95,100);"></div>
            <div class="ocr-tooltip">200 (Confidence: 37.64%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.772555410861969" data-text="3ia"
             data-original-text="3IA" data-index="48" data-page="0"
             data-edited="false" style="left:1001px;top:1023px;width:51px;height:31px;">
            <div class="underline" style="background-color:rgb(57,197,100);"></div>
            <div class="ocr-tooltip">3IA (Confidence: 77.26%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.14964772760868073" data-text="baaaatatrae"
             data-original-text="BAAAATATRAE" data-index="49" data-page="0"
             data-edited="false" style="left:1320px;top:1016px;width:138px;height:14px;">
            <div class="underline" style="background-color:rgb(216,38,100);"></div>
            <div class="ocr-tooltip">BAAAATATRAE (Confidence: 14.96%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.5496017336845398" data-text="vn"
             data-original-text="VN" data-index="50" data-page="0"
             data-edited="false" style="left:1436px;top:1037px;width:25px;height:17px;">
            <div class="underline" style="background-color:rgb(114,140,100);"></div>
            <div class="ocr-tooltip">VN (Confidence: 54.96%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.1623827964067459" data-text="nasise"
             data-original-text="NASISE" data-index="51" data-page="0"
             data-edited="false" style="left:991px;top:1059px;width:50px;height:16px;">
            <div class="underline" style="background-color:rgb(213,41,100);"></div>
            <div class="ocr-tooltip">NASISE (Confidence: 16.24%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.16554497182369232" data-text="saltstetcretae"
             data-original-text="SALTSTETCRETAE" data-index="52" data-page="0"
             data-edited="false" style="left:1230px;top:1055px;width:231px;height:21px;">
            <div class="underline" style="background-color:rgb(212,42,100);"></div>
            <div class="ocr-tooltip">SALTSTETCRETAE (Confidence: 16.55%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.146796315908432" data-text="w"
             data-original-text="w" data-index="53" data-page="0"
             data-edited="false" style="left:1462px;top:1050px;width:56px;height:22px;">
            <div class="underline" style="background-color:rgb(217,37,100);"></div>
            <div class="ocr-tooltip">w (Confidence: 14.68%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.5241410732269287" data-text="："
             data-original-text="：" data-index="54" data-page="0"
             data-edited="false" style="left:405px;top:1071px;width:22px;height:26px;">
            <div class="underline" style="background-color:rgb(121,133,100);"></div>
            <div class="ocr-tooltip">： (Confidence: 52.41%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.35175395011901855" data-text="-xoo"
             data-original-text="-XOO" data-index="55" data-page="0"
             data-edited="false" style="left:1051px;top:1058px;width:239px;height:87px;">
            <div class="underline" style="background-color:rgb(165,89,100);"></div>
            <div class="ocr-tooltip">-XOO (Confidence: 35.18%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.31116390228271484" data-text="55343"
             data-original-text="55343" data-index="56" data-page="0"
             data-edited="false" style="left:1043px;top:1080px;width:62px;height:18px;">
            <div class="underline" style="background-color:rgb(175,79,100);"></div>
            <div class="ocr-tooltip">55343 (Confidence: 31.12%)</div>
        </div>
        
        <div class="ocr-line" data-score="0.16230963170528412" data-text="teaeettee tess"
             data-original-text="TEAEETTEE TESS" data-index="57" data-page="0"
             data-edited="false" style="left:1293px;top:1108px;width:217px;height:20px;">
            <div class="underline" style="background-color:rgb(213,41,100);"></div>
            <div class="ocr-tooltip">TEAEETTEE TESS (Confidence: 16.23%)</div>
        </div>
        
            </div>
            
                    </div>
                </div>
            </div>
            
            <!-- Edit Text Modal -->
            <div id="editModal" class="modal">
                <div class="modal-content">
                    <h3>Edit Text</h3>
                    <textarea id="editTextArea"></textarea>
                    <div class="modal-buttons">
                        <button id="cancelEditBtn">Cancel</button>
                        <button id="saveEditBtn">Save</button>
                    </div>
                </div>
            </div>
            
            <!-- Add Text Modal -->
            <div id="addTextModal" class="modal">
                <div class="modal-content">
                    <h3>Add New Text</h3>
                    <textarea id="newTextArea" placeholder="Enter text..."></textarea>
                    <div class="modal-buttons">
                        <button id="cancelAddBtn">Cancel</button>
                        <button id="confirmAddBtn">Add</button>
                    </div>
                </div>
            </div>
            
            <!-- Stats Modal -->
            <div id="statsModal" class="modal">
                <div class="modal-content">
                    <h3>OCR Statistics</h3>
                    <div id="statsContent">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Total Text Elements</div>
                                <div class="stat-value" id="totalElements">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Average Confidence</div>
                                <div class="stat-value" id="avgConfidence">0%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Edited Elements</div>
                                <div class="stat-value" id="editedElements">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Low Confidence (<50%)</div>
                                <div class="stat-value" id="lowConfidence">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-buttons">
                        <button id="closeStatsBtn">Close</button>
                    </div>
                </div>
            </div>
            
            <!-- Export Modal -->
            <div id="exportModal" class="modal">
                <div class="modal-content">
                    <h3>Export OCR Data</h3>
                    <div class="export-options">
                        <div class="export-option">
                            <input type="radio" id="exportJson" name="exportFormat" value="json" checked>
                            <label for="exportJson">JSON Format</label>
                        </div>
                        <div class="export-option">
                            <input type="radio" id="exportText" name="exportFormat" value="text">
                            <label for="exportText">Plain Text</label>
                        </div>
                        <div class="export-option">
                            <input type="radio" id="exportCsv" name="exportFormat" value="csv">
                            <label for="exportCsv">CSV Format</label>
                        </div>
                    </div>
                    <div class="modal-buttons">
                        <button id="cancelExportBtn">Cancel</button>
                        <button id="confirmExportBtn">Export</button>
                    </div>
                </div>
            </div>
            
            <div class="drawing-box" id="drawingBox"></div>
            
            <script>
                
                // DOM Elements
                const elements = {
                    thresholdSlider: document.getElementById('thresholdSlider'),
                    thresholdVal: document.getElementById('thresholdVal'),
                    textFilter: document.getElementById('textFilter'),
                    addTextBtn: document.getElementById('addTextBtn'),
                    saveBtn: document.getElementById('saveBtn'),
                    editModal: document.getElementById('editModal'),
                    editTextArea: document.getElementById('editTextArea'),
                    cancelEditBtn: document.getElementById('cancelEditBtn'),
                    saveEditBtn: document.getElementById('saveEditBtn'),
                    addTextModal: document.getElementById('addTextModal'),
                    newTextArea: document.getElementById('newTextArea'),
                    cancelAddBtn: document.getElementById('cancelAddBtn'),
                    confirmAddBtn: document.getElementById('confirmAddBtn'),
                    drawingBox: document.getElementById('drawingBox'),
                    undoBtn: document.getElementById('undoBtn'),
                    redoBtn: document.getElementById('redoBtn'),
                    zoomInBtn: document.getElementById('zoomInBtn'),
                    zoomOutBtn: document.getElementById('zoomOutBtn'),
                    zoomResetBtn: document.getElementById('zoomResetBtn'),
                    zoomLevel: document.getElementById('zoomLevel'),
                    themeToggle: document.getElementById('themeToggle'),
                    statsBtn: document.getElementById('statsBtn'),
                    statsModal: document.getElementById('statsModal'),
                    closeStatsBtn: document.getElementById('closeStatsBtn'),
                    exportBtn: document.getElementById('exportBtn'),
                    exportModal: document.getElementById('exportModal'),
                    cancelExportBtn: document.getElementById('cancelExportBtn'),
                    confirmExportBtn: document.getElementById('confirmExportBtn'),
                    pagesWrapper: document.getElementById('pagesWrapper'),
                    collapseBtn: document.getElementById('collapseBtn'),
                    collapseIcon: document.getElementById('collapseIcon'),
                    toolbarSecondRow: document.getElementById('toolbarSecondRow'),
                    progressBar: document.getElementById('progressBar'),
                    progressFill: document.getElementById('progressFill'),
                    progressText: document.getElementById('progressText'),
                    thumbnailSidebar: document.getElementById('thumbnailSidebar')
                };
            

                // State
                let state = {
                    currentEditElement: null,
                    isDrawing: false,
                    startX: 0, startY: 0, endX: 0, endY: 0,
                    currentPageContainer: null,
                    ocrData: { pages: [] },
                    zoomLevel: 1.0,
                    selectedElements: new Set(),
                    undoStack: [],
                    redoStack: [],
                    toolbarCollapsed: false,
                    currentPage: 0,
                    totalPages: 0,
                    loadedPages: new Set(),
                    loading: false
                };
            

                // Initialize
                function init() {
                    // Get total number of pages
                    state.totalPages = document.querySelectorAll('.page-container').length;
                    
                    // Initialize OCR data structure
                    document.querySelectorAll('.page-container').forEach(pageContainer => {
                        const pageIdx = parseInt(pageContainer.id.split('-')[1]);
                        state.ocrData.pages[pageIdx] = { rec_texts: [], rec_scores: [], rec_boxes: [], edited: [] };
                        
                        // Only process non-lazy pages initially
                        if (!pageContainer.classList.contains('lazy-page')) {
                            state.loadedPages.add(pageIdx);
                            
                            pageContainer.querySelectorAll('.ocr-line').forEach(line => {
                                const index = parseInt(line.dataset.index);
                                state.ocrData.pages[pageIdx].rec_texts[index] = line.dataset.originalText;
                                state.ocrData.pages[pageIdx].rec_scores[index] = parseFloat(line.dataset.score);
                                state.ocrData.pages[pageIdx].edited[index] = line.dataset.edited === "true";
                                
                                const rect = line.getBoundingClientRect();
                                state.ocrData.pages[pageIdx].rec_boxes[index] = [
                                    rect.left, rect.top, rect.right, rect.bottom
                                ];
                            });
                        }
                    });
                    
                    // Set initial zoom
                    setZoom(state.zoomLevel);
                    
                    // Load toolbar state
                    loadToolbarState();
                    
                    // Setup lazy loading
                    setupLazyLoading();
                    
                    // Setup thumbnail navigation
                    setupThumbnailNavigation();
                    
                    // Event Listeners
                    setupEventListeners();
                    
                    updateColors();
                }
                
                function setupEventListeners() {
                    // Basic controls
                    elements.thresholdSlider.addEventListener('input', updateColors);
                    elements.textFilter.addEventListener('input', updateTextFilter);
                    elements.saveEditBtn.addEventListener('click', saveEditedText);
                    elements.cancelEditBtn.addEventListener('click', () => elements.editModal.style.display = 'none');
                    elements.addTextBtn.addEventListener('click', startAddTextMode);
                    elements.confirmAddBtn.addEventListener('click', confirmAddText);
                    elements.cancelAddBtn.addEventListener('click', cancelAddText);
                    elements.saveBtn.addEventListener('click', saveChanges);
                    
                    // Undo/Redo
                    elements.undoBtn.addEventListener('click', undo);
                    elements.redoBtn.addEventListener('click', redo);
                    
                    // Zoom controls
                    elements.zoomInBtn.addEventListener('click', () => setZoom(state.zoomLevel + 0.1));
                    elements.zoomOutBtn.addEventListener('click', () => setZoom(state.zoomLevel - 0.1));
                    elements.zoomResetBtn.addEventListener('click', () => setZoom(1.0));
                    
                    // Theme toggle
                    elements.themeToggle.addEventListener('click', toggleTheme);
                    
                    // Stats
                    elements.statsBtn.addEventListener('click', showStats);
                    elements.closeStatsBtn.addEventListener('click', () => elements.statsModal.style.display = 'none');
                    
                    // Export
                    elements.exportBtn.addEventListener('click', () => elements.exportModal.style.display = 'block');
                    elements.cancelExportBtn.addEventListener('click', () => elements.exportModal.style.display = 'none');
                    elements.confirmExportBtn.addEventListener('click', exportData);
                    
                    // Toolbar collapse
                    elements.collapseBtn.addEventListener('click', toggleToolbar);
                    
                    // OCR line click handlers with multi-select support
                    document.querySelectorAll('.ocr-line').forEach(line => {
                        line.addEventListener('click', (e) => {
                            if (e.ctrlKey || e.metaKey) {
                                // Multi-select with Ctrl/Cmd
                                e.stopPropagation();
                                if (state.selectedElements.has(line)) {
                                    state.selectedElements.delete(line);
                                    line.classList.remove('selected');
                                } else {
                                    state.selectedElements.add(line);
                                    line.classList.add('selected');
                                }
                            } else {
                                // Single selection
                                state.selectedElements.forEach(el => el.classList.remove('selected'));
                                state.selectedElements.clear();
                                
                                e.stopPropagation();
                                state.currentEditElement = line;
                                elements.editTextArea.value = line.dataset.originalText;
                                elements.editModal.style.display = 'block';
                            }
                        });
                    });
                    
                    // Keyboard shortcuts
                    document.addEventListener('keydown', handleKeyboardShortcuts);
                    
                    window.addEventListener('click', (e) => {
                        if (e.target === elements.editModal) elements.editModal.style.display = 'none';
                        if (e.target === elements.addTextModal) cancelAddText();
                        if (e.target === elements.statsModal) elements.statsModal.style.display = 'none';
                        if (e.target === elements.exportModal) elements.exportModal.style.display = 'none';
                    });
                }
                
                function handleKeyboardShortcuts(e) {
                    // Ctrl/Cmd + S to save
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        saveChanges();
                    }
                    
                    // Ctrl/Cmd + F to focus search
                    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                        e.preventDefault();
                        elements.textFilter.focus();
                    }
                    
                    // Esc to close modals
                    if (e.key === 'Escape') {
                        elements.editModal.style.display = 'none';
                        elements.addTextModal.style.display = 'none';
                        elements.statsModal.style.display = 'none';
                        elements.exportModal.style.display = 'none';
                    }
                    
                    // Ctrl/Cmd + N to add new text
                    if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                        e.preventDefault();
                        startAddTextMode();
                    }
                    
                    // Ctrl/Cmd + Z to undo
                    if ((e.ctrlKey || e.metaKey) && e.key === 'z') {
                        e.preventDefault();
                        undo();
                    }
                    
                    // Ctrl/Cmd + Y to redo
                    if ((e.ctrlKey || e.metaKey) && e.key === 'y') {
                        e.preventDefault();
                        redo();
                    }
                }
            

                // Core Functions
                function updateColors() {
                    const threshold = parseFloat(elements.thresholdSlider.value);
                    elements.thresholdVal.textContent = threshold.toFixed(2);
                    
                    document.querySelectorAll('.ocr-line').forEach(el => {
                        const score = parseFloat(el.dataset.score);
                        const isEdited = el.dataset.edited === "true";
                        const color = isEdited ? 'rgb(245, 158, 11)' : 
                                    (score >= threshold ? 'rgb(16, 185, 129)' : 'rgb(239, 68, 68)');
                        el.querySelector('.underline').style.backgroundColor = color;
                    });
                }
                
                function updateTextFilter() {
                    const keyword = elements.textFilter.value.trim().toLowerCase();
                    document.querySelectorAll('.ocr-line').forEach(el => {
                        el.style.display = !keyword || el.dataset.text.includes(keyword) ? "block" : "none";
                    });
                }
                
                function saveEditedText() {
                    if (!state.currentEditElement) return;
                    
                    const newText = elements.editTextArea.value;
                    const safeText = newText.replace(/"/g, '&quot;').replace(/'/g, '&apos;');
                    const line = state.currentEditElement;
                    const score = parseFloat(line.dataset.score);
                    
                    // Save state for undo
                    saveState();
                    
                    // Update element
                    line.dataset.originalText = newText;
                    line.dataset.text = safeText.toLowerCase();
                    line.dataset.edited = "true";
                    line.querySelector('.ocr-tooltip').textContent = `${newText} (Confidence: ${(score*100).toFixed(1)}%) [Edited]`;
                    
                    if (!line.querySelector('.edited-badge')) {
                        const badge = document.createElement('div');
                        badge.className = 'edited-badge';
                        badge.textContent = 'EDITED';
                        line.appendChild(badge);
                    }
                    
                    // Update data
                    const pageIdx = parseInt(line.dataset.page);
                    const index = parseInt(line.dataset.index);
                    state.ocrData.pages[pageIdx].rec_texts[index] = newText;
                    state.ocrData.pages[pageIdx].edited[index] = true;
                    
                    elements.editModal.style.display = 'none';
                    state.currentEditElement = null;
                    updateColors();
                }
            

                // Add Text Functions
                function startAddTextMode() {
                    elements.addTextModal.style.display = 'none';
                    elements.newTextArea.value = '';
                    state.isDrawing = false;
                    elements.drawingBox.style.display = 'none';
                    
                    document.querySelectorAll('.page-container').forEach(container => {
                        container.style.pointerEvents = 'auto';
                        container.style.cursor = 'crosshair';
                    });
                    
                    showNotification('Draw a bounding box where you want to add text', 'info');
                }
                
                function confirmAddText() {
                    const text = elements.newTextArea.value.trim();
                    if (!text || elements.drawingBox.style.display !== 'block' || !state.currentPageContainer) return;
                    
                    const left = parseInt(elements.drawingBox.style.left);
                    const top = parseInt(elements.drawingBox.style.top);
                    const width = parseInt(elements.drawingBox.style.width);
                    const height = parseInt(elements.drawingBox.style.height);
                    
                    if (width > 10 && height > 10) {
                        const safeText = text.replace(/"/g, '&quot;').replace(/'/g, '&apos;');
                        const pageIdx = parseInt(state.currentPageContainer.id.split('-')[1]);
                        
                        // Save state for undo
                        saveState();
                        
                        // Create new element
                        const newLine = document.createElement('div');
                        newLine.className = 'ocr-line';
                        newLine.dataset.score = '1.0';
                        newLine.dataset.text = safeText.toLowerCase();
                        newLine.dataset.originalText = safeText;
                        newLine.dataset.index = state.ocrData.pages[pageIdx].rec_texts.length;
                        newLine.dataset.page = pageIdx;
                        newLine.dataset.edited = "true";
                        newLine.style.left = `${left}px`;
                        newLine.style.top = `${top}px`;
                        newLine.style.width = `${width}px`;
                        newLine.style.height = `${height}px`;
                        newLine.innerHTML = `
                            <div class="underline" style="background-color:rgb(245, 158, 11);"></div>
                            <div class="ocr-tooltip">${safeText} (Confidence: 100.0%) [Added]</div>
                            <div class="edited-badge">ADDED</div>
                        `;
                        
                        newLine.addEventListener('click', (e) => {
                            if (e.ctrlKey || e.metaKey) {
                                // Multi-select with Ctrl/Cmd
                                e.stopPropagation();
                                if (state.selectedElements.has(newLine)) {
                                    state.selectedElements.delete(newLine);
                                    newLine.classList.remove('selected');
                                } else {
                                    state.selectedElements.add(newLine);
                                    newLine.classList.add('selected');
                                }
                            } else {
                                // Single selection
                                state.selectedElements.forEach(el => el.classList.remove('selected'));
                                state.selectedElements.clear();
                                
                                e.stopPropagation();
                                state.currentEditElement = newLine;
                                elements.editTextArea.value = newLine.dataset.originalText;
                                elements.editModal.style.display = 'block';
                            }
                        });
                        
                        state.currentPageContainer.appendChild(newLine);
                        
                        // Update data
                        state.ocrData.pages[pageIdx].rec_texts.push(text);
                        state.ocrData.pages[pageIdx].rec_scores.push(1.0);
                        state.ocrData.pages[pageIdx].edited.push(true);
                        state.ocrData.pages[pageIdx].rec_boxes.push([left, top, left+width, top+height]);
                        
                        showNotification('Text added successfully', 'success');
                    }
                    
                    cancelAddText();
                    updateColors();
                }
                
                function cancelAddText() {
                    elements.addTextModal.style.display = 'none';
                    elements.drawingBox.style.display = 'none';
                    document.querySelectorAll('.page-container').forEach(container => {
                        container.style.pointerEvents = '';
                        container.style.cursor = '';
                    });
                }
            

                // Save Functions
                async function saveChanges() {
                    showProgress(0, 'Saving...');
                    
                    try {
                        // Simulate progress updates
                        let progress = 0;
                        const progressInterval = setInterval(() => {
                            progress += 10;
                            showProgress(progress, 'Saving...');
                            if (progress >= 90) {
                                clearInterval(progressInterval);
                            }
                        }, 200);
                        
                        const response = await fetch('http://localhost:2500/save_ocr_data', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(state.ocrData)
                        });
                        
                        clearInterval(progressInterval);
                        showProgress(100, 'Complete!');
                        
                        if (response.ok) {
                            showNotification('OCR data saved successfully!', 'success');
                        } else {
                            showNotification('Failed to save OCR data.', 'error');
                        }
                        
                        // Hide progress bar after a delay
                        setTimeout(() => {
                            hideProgress();
                        }, 1000);
                    } catch (error) {
                        console.error('Error:', error);
                        hideProgress();
                        showNotification('Error saving data. See console for details.', 'error');
                    }
                }
            

                // Progress bar functions
                function showProgress(percent, text) {
                    elements.progressBar.style.display = 'block';
                    elements.progressFill.style.width = `${percent}%`;
                    elements.progressText.textContent = text;
                }
                
                function hideProgress() {
                    elements.progressBar.style.display = 'none';
                }
            

                // Lazy loading functions
                function setupLazyLoading() {
                    // Create an IntersectionObserver to detect when pages come into view
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting && !entry.target.classList.contains('loaded')) {
                                loadPage(entry.target);
                            }
                        });
                    }, {
                        root: elements.pagesWrapper,
                        rootMargin: '200px', // Load pages when they're within 200px of the viewport
                        threshold: 0.1
                    });
                    
                    // Observe all lazy pages
                    document.querySelectorAll('.lazy-page').forEach(page => {
                        observer.observe(page);
                    });
                }
                
                function loadPage(pageElement) {
                    const pageIdx = parseInt(pageElement.dataset.pageIndex);
                    
                    // Show loading state
                    const placeholder = pageElement.querySelector('.page-placeholder');
                    if (placeholder) {
                        placeholder.textContent = `Loading Page ${pageIdx + 1}...`;
                    }
                    
                    // Simulate loading delay for demonstration
                    setTimeout(() => {
                        // In a real implementation, you would fetch the page data here
                        // For this example, we'll just show the content
                        const content = pageElement.querySelector('.page-content');
                        if (content) {
                            content.style.display = 'block';
                            pageElement.classList.add('loaded');
                            
                            // Hide placeholder
                            if (placeholder) {
                                placeholder.style.display = 'none';
                            }
                            
                            // Load the image
                            const img = content.querySelector('.ocr-image');
                            if (img && img.dataset.src) {
                                img.src = img.dataset.src;
                            }
                            
                            // Process OCR lines for this page
                            content.querySelectorAll('.ocr-line').forEach(line => {
                                const index = parseInt(line.dataset.index);
                                state.ocrData.pages[pageIdx].rec_texts[index] = line.dataset.originalText;
                                state.ocrData.pages[pageIdx].rec_scores[index] = parseFloat(line.dataset.score);
                                state.ocrData.pages[pageIdx].edited[index] = line.dataset.edited === "true";
                                
                                const rect = line.getBoundingClientRect();
                                state.ocrData.pages[pageIdx].rec_boxes[index] = [
                                    rect.left, rect.top, rect.right, rect.bottom
                                ];
                            });
                            
                            // Mark page as loaded
                            state.loadedPages.add(pageIdx);
                            
                            // Update active thumbnail
                            updateActiveThumbnail(pageIdx);
                        }
                    }, 500); // Simulate loading time
                }
            

                // Thumbnail navigation functions
                function setupThumbnailNavigation() {
                    // Add click event to thumbnails
                    document.querySelectorAll('.thumbnail').forEach(thumbnail => {
                        thumbnail.addEventListener('click', () => {
                            const pageIdx = parseInt(thumbnail.dataset.page);
                            scrollToPage(pageIdx);
                        });
                    });
                    
                    // Set initial active thumbnail
                    updateActiveThumbnail(0);
                }
                
                function scrollToPage(pageIdx) {
                    const pageElement = document.getElementById(`page-${pageIdx}`);
                    if (pageElement) {
                        pageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        state.currentPage = pageIdx;
                        updateActiveThumbnail(pageIdx);
                        
                        // If the page is lazy and not loaded, load it now
                        if (pageElement.classList.contains('lazy-page') && !pageElement.classList.contains('loaded')) {
                            loadPage(pageElement);
                        }
                    }
                }
                
                function updateActiveThumbnail(pageIdx) {
                    // Remove active class from all thumbnails
                    document.querySelectorAll('.thumbnail').forEach(thumb => {
                        thumb.classList.remove('active');
                    });
                    
                    // Add active class to current thumbnail
                    const activeThumb = document.querySelector(`.thumbnail[data-page="${pageIdx}"]`);
                    if (activeThumb) {
                        activeThumb.classList.add('active');
                    }
                }
            

                // Undo/Redo functionality
                function saveState() {
                    state.undoStack.push(JSON.stringify(state.ocrData));
                    state.redoStack = []; // Clear redo stack when new action is performed
                    updateUndoRedoButtons();
                }
                
                function undo() {
                    if (state.undoStack.length === 0) return;
                    
                    const currentState = JSON.stringify(state.ocrData);
                    state.redoStack.push(currentState);
                    
                    const previousState = state.undoStack.pop();
                    state.ocrData = JSON.parse(previousState);
                    
                    updateUndoRedoButtons();
                    refreshUI();
                    showNotification('Undo successful', 'info');
                }
                
                function redo() {
                    if (state.redoStack.length === 0) return;
                    
                    const currentState = JSON.stringify(state.ocrData);
                    state.undoStack.push(currentState);
                    
                    const nextState = state.redoStack.pop();
                    state.ocrData = JSON.parse(nextState);
                    
                    updateUndoRedoButtons();
                    refreshUI();
                    showNotification('Redo successful', 'info');
                }
                
                function updateUndoRedoButtons() {
                    elements.undoBtn.disabled = state.undoStack.length === 0;
                    elements.redoBtn.disabled = state.redoStack.length === 0;
                }
                
                function refreshUI() {
                    // This would refresh the entire UI based on the current state
                    // For simplicity, we'll just reload the page
                    location.reload();
                }
            

                // Zoom functionality
                function setZoom(level) {
                    level = Math.max(0.3, Math.min(2.0, level)); // Limit zoom range
                    state.zoomLevel = level;
                    
                    document.querySelectorAll('.page-container').forEach(container => {
                        container.style.transform = `scale(${level})`;
                    });
                    
                    elements.zoomLevel.textContent = `${Math.round(level * 100)}%`;
                }
            

                // Theme toggle
                function toggleTheme() {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                }
                
                // Load saved theme
                function loadTheme() {
                    const savedTheme = localStorage.getItem('theme') || 'dark';
                    document.documentElement.setAttribute('data-theme', savedTheme);
                }
            

                // Toolbar collapse functionality
                function toggleToolbar() {
                    state.toolbarCollapsed = !state.toolbarCollapsed;
                    
                    if (state.toolbarCollapsed) {
                        elements.toolbarSecondRow.classList.add('collapsed');
                        elements.collapseIcon.innerHTML = `
                            <polyline points="6 9 12 15 18 9"></polyline>
                        `;
                    } else {
                        elements.toolbarSecondRow.classList.remove('collapsed');
                        elements.collapseIcon.innerHTML = `
                            <polyline points="18 15 12 9 6 15"></polyline>
                        `;
                    }
                    
                    // Save state to localStorage
                    localStorage.setItem('toolbarCollapsed', state.toolbarCollapsed);
                }
                
                function loadToolbarState() {
                    const savedState = localStorage.getItem('toolbarCollapsed');
                    if (savedState !== null) {
                        state.toolbarCollapsed = savedState === 'true';
                        
                        if (state.toolbarCollapsed) {
                            elements.toolbarSecondRow.classList.add('collapsed');
                            elements.collapseIcon.innerHTML = `
                                <polyline points="6 9 12 15 18 9"></polyline>
                            `;
                        }
                    }
                }
            

                // Statistics
                function showStats() {
                    let totalElements = 0;
                    let totalConfidence = 0;
                    let editedElements = 0;
                    let lowConfidence = 0;
                    
                    state.ocrData.pages.forEach(page => {
                        totalElements += page.rec_texts.length;
                        page.rec_scores.forEach(score => {
                            totalConfidence += score;
                            if (score < 0.5) lowConfidence++;
                        });
                        editedElements += page.edited.filter(edited => edited).length;
                    });
                    
                    const avgConfidence = totalElements > 0 ? (totalConfidence / totalElements * 100).toFixed(1) : 0;
                    
                    document.getElementById('totalElements').textContent = totalElements;
                    document.getElementById('avgConfidence').textContent = `${avgConfidence}%`;
                    document.getElementById('editedElements').textContent = editedElements;
                    document.getElementById('lowConfidence').textContent = lowConfidence;
                    
                    elements.statsModal.style.display = 'block';
                }
            

                // Export functionality
                function exportData() {
                    const format = document.querySelector('input[name="exportFormat"]:checked').value;
                    let content = '';
                    let filename = '';
                    
                    switch(format) {
                        case 'json':
                            content = JSON.stringify(state.ocrData, null, 2);
                            filename = 'ocr_data.json';
                            break;
                        case 'text':
                            content = state.ocrData.pages.map(page => 
                                page.rec_texts.join('\n')
                            ).join('\n\n--- Page Break ---\n\n');
                            filename = 'ocr_text.txt';
                            break;
                        case 'csv':
                            content = 'Page,Index,Text,Confidence,Edited\n';
                            state.ocrData.pages.forEach((page, pageIndex) => {
                                page.rec_texts.forEach((text, index) => {
                                    content += `${pageIndex + 1},${index + 1},"${text.replace(/"/g, '""')}",${(page.rec_scores[index] * 100).toFixed(1)}%,${page.edited[index] ? 'Yes' : 'No'}\n`;
                                });
                            });
                            filename = 'ocr_data.csv';
                            break;
                    }
                    
                    downloadFile(content, filename);
                    elements.exportModal.style.display = 'none';
                    showNotification(`Data exported as ${format.toUpperCase()}`, 'success');
                }
                
                function downloadFile(content, filename) {
                    const blob = new Blob([content], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }
            

                // Modern notification system instead of alerts
                function showNotification(message, type = 'info') {
                    const notification = document.createElement('div');
                    notification.className = 'notification';
                    notification.style.position = 'fixed';
                    notification.style.bottom = '20px';
                    notification.style.right = '20px';
                    notification.style.padding = '12px 20px';
                    notification.style.borderRadius = '8px';
                    notification.style.zIndex = '3000';
                    notification.style.fontWeight = '500';
                    notification.style.maxWidth = '300px';
                    notification.style.animation = 'slideInRight 0.3s, fadeOut 0.5s 2.5s forwards';
                    
                    // Set color based on type
                    if (type === 'success') {
                        notification.style.backgroundColor = 'rgb(16, 185, 129)';
                        notification.style.color = 'white';
                    } else if (type === 'error') {
                        notification.style.backgroundColor = 'rgb(239, 68, 68)';
                        notification.style.color = 'white';
                    } else {
                        notification.style.backgroundColor = 'var(--bg-secondary)';
                        notification.style.color = 'var(--text-primary)';
                        notification.style.border = '1px solid var(--border)';
                    }
                    
                    notification.textContent = message;
                    document.body.appendChild(notification);
                    
                    // Remove notification after animation
                    setTimeout(() => {
                        notification.remove();
                    }, 3000);
                }
            

                // Drawing handlers
                function setupDrawingHandlers() {
                    document.querySelectorAll('.page-container').forEach(container => {
                        container.addEventListener('mousedown', (e) => {
                            if (elements.addTextModal.style.display === 'none' && 
                                document.querySelector('.page-container').style.cursor === 'crosshair') {
                                e.preventDefault();
                                state.isDrawing = true;
                                state.startX = e.clientX - container.getBoundingClientRect().left;
                                state.startY = e.clientY - container.getBoundingClientRect().top;
                                
                                elements.drawingBox.style.left = `${state.startX}px`;
                                elements.drawingBox.style.top = `${state.startY}px`;
                                elements.drawingBox.style.width = '0px';
                                elements.drawingBox.style.height = '0px';
                                elements.drawingBox.style.display = 'block';
                                state.currentPageContainer = container;
                            }
                        });
                        
                        container.addEventListener('mousemove', (e) => {
                            if (!state.isDrawing) return;
                            const currentX = e.clientX - container.getBoundingClientRect().left;
                            const currentY = e.clientY - container.getBoundingClientRect().top;
                            
                            elements.drawingBox.style.left = `${Math.min(state.startX, currentX)}px`;
                            elements.drawingBox.style.top = `${Math.min(state.startY, currentY)}px`;
                            elements.drawingBox.style.width = `${Math.abs(currentX - state.startX)}px`;
                            elements.drawingBox.style.height = `${Math.abs(currentY - state.startY)}px`;
                        });
                        
                        container.addEventListener('mouseup', (e) => {
                            if (!state.isDrawing) return;
                            state.isDrawing = false;
                            state.endX = e.clientX - state.currentPageContainer.getBoundingClientRect().left;
                            state.endY = e.clientY - state.currentPageContainer.getBoundingClientRect().top;
                            
                            if (Math.abs(state.endX - state.startX) > 10 && Math.abs(state.endY - state.startY) > 10) {
                                elements.addTextModal.style.display = 'block';
                            } else {
                                elements.drawingBox.style.display = 'none';
                                showNotification('Please draw a larger box', 'info');
                            }
                        });
                    });
                }
            

                // Add CSS for notification animations
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
                
                // Start the application
                loadTheme();
                init();
                setupDrawingHandlers();
            
            </script>
        </body>
        </html>